<!doctype html>
<html lang="en">
  <head>
    {% include "_head.html" %}
  </head>
  <body>
    {% include "_navbar.html" %}

    <div class="container">

      {% include "_message.html" %}
      {% include "_collapsibles.html" %}

      {% if tag_query %}
      <div class="alert alert-secondary tag_query" role="alert">
        Filtering to documents tagged with
        {% for tag in tag_query %}
          <span class="tag_query__tag">
            <strong>{{ tag }}</strong>
            <a class="text-danger" id="removeTag:{{ tag }}" href="{{ req_url.remove('tag', tag).remove('page') | query_str_only }}">x</a>
          </span>
        {% endfor %}
      </div>
      {% endif %}

      <p></p>

    {% if display_documents %}
      <main class="documents documents__view_{{ view_options.list_view }}">
      {% for doc in display_documents %}
      <section>
        <div class="document card">
          <div class="document__image">
            <a href="{{ doc | file_url }}" target="_blank">
            {% if "thumbnail_identifier" in doc %}
              <img src="{{ doc | thumbnail_url }}">
            {% else %}
              <img src="{{ 'placeholder.jpg' | static_url }}">
            {% endif %}
            </a>
          </div>

          <div class="document__panel">

            {% if doc.title %}
            <div class="document__title">
              <a href="{{ doc | file_url }}" target="_blank">
              <h3>{{ doc.title | smartypants | safe }}</h3>
              </a>
            </div>
            {% endif %}

            <div class="document__info">
              <div class="document__metadata document__metadata__date_created">
                <p class="document__metadata__title">date created</p>
                <h5 class="document__metadata__info">{{ doc["date_created"] | since_now_date_str }}</h5>
              </div>

              {% if "user_data" in doc and "source_url" in doc["user_data"] and doc["user_data"]["source_url"] %}
              <div class="document__metadata document__metadata__source_url">
                <p class="document__metadata__title">source</p>
                <h5 class="document__metadata__info"><a href="{{ doc['user_data']['source_url'] }}">{{ doc['user_data']['source_url'] | short_url }}</a></h5>
              </div>
              {% endif %}

              {% if doc["tags"] %}
              <div class="document__metadata document__metadata__tags">
                <p class="document__metadata__title">tags</p>
                <h5 class="document__metadata__info">
                {% for tag in doc["tags"]|sort %}
                <span class="document__metadata__info_tag">
                {% if tag not in tag_query %}
                  <a href="{{ req_url.add('tag', tag).remove('page') | query_str_only }}">
                {% endif %}
                #{{ tag }}
                {%- if tag not in tag_query %}</a>{% endif %}
                </span>
                {% endfor %}
                </h5>
              </div>
              {% endif %}

            </div>
          </div>
        </div>
      </section>
      {% endfor %}
      </main>
    {% else %}
      No documents found!
    {% endif %}

    {% include "_pagination.html" %}

    </div>
  </body>

  {% include "_footer.html" %}
</html>
